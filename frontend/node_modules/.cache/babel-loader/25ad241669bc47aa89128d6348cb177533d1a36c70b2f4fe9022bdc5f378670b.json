{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Box,TextField,Button,Grid,Typography}from'@mui/material';import{useNavigate}from'react-router-dom';import axios from'axios';import AlertMessage from'../../components/AlertMessage';import{isAuthenticated}from'../../utils/auth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CrearRoles=()=>{const[showAlert,setShowAlert]=useState(null);// Estado de la alerta\nconst navigate=useNavigate();// Estados para los campos del formulario\nconst[rolName,setRolName]=useState('');const[descripcion,setDescripcion]=useState('');// Verificar si el usuario está autenticado al cargar el componente\nuseEffect(()=>{// Si el usuario no está autenticado, redirige al login\nif(!isAuthenticated()){navigate('/login');// Redirige al login si no está autenticado\n}},[navigate]);// Función para manejar el envío del formulario\nconst handleSubmit=async e=>{e.preventDefault();// Validaciones simples\nif(!rolName||!descripcion){setShowAlert({severity:'error',message:'Todos los campos son obligatorios.'});return;}const newRole={rolName,descripcion};try{// Obtener el token JWT desde el almacenamiento local o cookies\nconst token=localStorage.getItem('token');// Verificar si el token existe\nif(!token){setShowAlert({severity:'error',message:'No se encontró el token de autenticación.'});return;}// Configuración del encabezado con el token\nconst config={headers:{'x-auth-token':token// Enviar el token JWT en la cabecera\n}};const response=await axios.post('http://localhost:5000/api/roles/register',newRole,config);// Verificar la respuesta de la API\nif(response.data.msg==='El rol ya existe'){setShowAlert({severity:'error',message:response.data.msg// Mostrar el mensaje de error\n});}else if(response.data.msg==='Rol registrado correctamente'){setShowAlert({severity:'success',message:response.data.msg// Mostrar el mensaje de éxito\n});// Limpiar los campos del formulario si el rol se creó con éxito\nsetRolName('');setDescripcion('');// Redirigir a la lista de roles después de 3 segundos\nsetTimeout(()=>{navigate('/seguridad/roles');},2000);}}catch(error){// Si hay un error específico de la API\nif(error.response&&error.response.data&&error.response.data.msg){setShowAlert({severity:'error',message:error.response.data.msg});}else{setShowAlert({severity:'error',message:'Hubo un error al crear el rol. Inténtalo de nuevo.'});}}};return/*#__PURE__*/_jsxs(Box,{sx:{padding:5},children:[showAlert&&/*#__PURE__*/_jsx(AlertMessage,{severity:showAlert.severity,message:showAlert.message,autoHideDuration:2000// La alerta se cierra después de 3 segundos\n,sx:{mb:4}}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"Crear Nuevo Rol\"}),/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Nombre del Rol\",value:rolName,onChange:e=>setRolName(e.target.value),required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Descripci\\xF3n\",value:descripcion,onChange:e=>setDescripcion(e.target.value),required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(Button,{type:\"submit\",variant:\"contained\",color:\"primary\",fullWidth:true,children:\"Crear Rol\"})})]})})]});};export default CrearRoles;","map":{"version":3,"names":["React","useState","useEffect","Box","TextField","Button","Grid","Typography","useNavigate","axios","AlertMessage","isAuthenticated","jsx","_jsx","jsxs","_jsxs","CrearRoles","showAlert","setShowAlert","navigate","rolName","setRolName","descripcion","setDescripcion","handleSubmit","e","preventDefault","severity","message","newRole","token","localStorage","getItem","config","headers","response","post","data","msg","setTimeout","error","sx","padding","children","autoHideDuration","mb","variant","gutterBottom","onSubmit","container","spacing","item","xs","sm","fullWidth","label","value","onChange","target","required","type","color"],"sources":["C:/Users/Administrador/Documents/Proyectos/control_calidad/frontend/src/pages/Seguridad/CrearRoles.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Box, TextField, Button, Grid, Typography } from '@mui/material';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport AlertMessage from '../../components/AlertMessage';\r\nimport { isAuthenticated } from '../../utils/auth';\r\n\r\nconst CrearRoles = () => {\r\n  const [showAlert, setShowAlert] = useState(null); // Estado de la alerta\r\n  const navigate = useNavigate();\r\n\r\n  // Estados para los campos del formulario\r\n  const [rolName, setRolName] = useState('');\r\n  const [descripcion, setDescripcion] = useState('');\r\n\r\n  // Verificar si el usuario está autenticado al cargar el componente\r\n  useEffect(() => {\r\n    // Si el usuario no está autenticado, redirige al login\r\n    if (!isAuthenticated()) {\r\n      navigate('/login'); // Redirige al login si no está autenticado\r\n    }\r\n  }, [navigate]);\r\n\r\n  // Función para manejar el envío del formulario\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n\r\n    // Validaciones simples\r\n    if (!rolName || !descripcion) {\r\n      setShowAlert({\r\n        severity: 'error',\r\n        message: 'Todos los campos son obligatorios.',\r\n      });\r\n      return;\r\n    }\r\n\r\n    const newRole = { rolName, descripcion };\r\n\r\n    try {\r\n      // Obtener el token JWT desde el almacenamiento local o cookies\r\n      const token = localStorage.getItem('token');\r\n\r\n      // Verificar si el token existe\r\n      if (!token) {\r\n        setShowAlert({\r\n          severity: 'error',\r\n          message: 'No se encontró el token de autenticación.',\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Configuración del encabezado con el token\r\n      const config = {\r\n        headers: {\r\n          'x-auth-token': token, // Enviar el token JWT en la cabecera\r\n        },\r\n      };\r\n\r\n      const response = await axios.post('http://localhost:5000/api/roles/register', newRole, config);\r\n\r\n      // Verificar la respuesta de la API\r\n      if (response.data.msg === 'El rol ya existe') {\r\n        setShowAlert({\r\n          severity: 'error',\r\n          message: response.data.msg, // Mostrar el mensaje de error\r\n        });\r\n      } else if (response.data.msg === 'Rol registrado correctamente') {\r\n        setShowAlert({\r\n          severity: 'success',\r\n          message: response.data.msg, // Mostrar el mensaje de éxito\r\n        });\r\n\r\n        // Limpiar los campos del formulario si el rol se creó con éxito\r\n        setRolName('');\r\n        setDescripcion('');\r\n\r\n        // Redirigir a la lista de roles después de 3 segundos\r\n        setTimeout(() => {\r\n          navigate('/seguridad/roles');\r\n        }, 2000);\r\n      }\r\n    } catch (error) {\r\n      // Si hay un error específico de la API\r\n      if (error.response && error.response.data && error.response.data.msg) {\r\n        setShowAlert({\r\n          severity: 'error',\r\n          message: error.response.data.msg,\r\n        });\r\n      } else {\r\n        setShowAlert({\r\n          severity: 'error',\r\n          message: 'Hubo un error al crear el rol. Inténtalo de nuevo.',\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ padding: 5 }}>\r\n      {/* Mostrar la alerta si hay alguna */}\r\n      {showAlert && (\r\n        <AlertMessage\r\n          severity={showAlert.severity}\r\n          message={showAlert.message}\r\n          autoHideDuration={2000} // La alerta se cierra después de 3 segundos\r\n          sx={{ mb: 4 }}\r\n        />\r\n      )}\r\n\r\n      <Typography variant=\"h4\" gutterBottom>\r\n        Crear Nuevo Rol\r\n      </Typography>\r\n\r\n      <form onSubmit={handleSubmit}>\r\n        <Grid container spacing={2}>\r\n          {/* Campo para Nombre del Rol */}\r\n          <Grid item xs={12} sm={6}>\r\n            <TextField\r\n              fullWidth\r\n              label=\"Nombre del Rol\"\r\n              value={rolName}\r\n              onChange={(e) => setRolName(e.target.value)}\r\n              required\r\n            />\r\n          </Grid>\r\n\r\n          {/* Campo para Descripción */}\r\n          <Grid item xs={12} sm={6}>\r\n            <TextField\r\n              fullWidth\r\n              label=\"Descripción\"\r\n              value={descripcion}\r\n              onChange={(e) => setDescripcion(e.target.value)}\r\n              required\r\n            />\r\n          </Grid>\r\n\r\n          {/* Botón para enviar el formulario */}\r\n          <Grid item xs={6}>\r\n            <Button type=\"submit\" variant=\"contained\" color=\"primary\" fullWidth>\r\n              Crear Rol\r\n            </Button>\r\n          </Grid>\r\n        </Grid>\r\n      </form>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default CrearRoles;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}